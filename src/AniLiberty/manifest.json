{
  "id": "aniliberty",
  "name": "AniLiberty",
  "description": "AniLiberty is an online streaming provider for Russian anime with high-quality streams",
  "manifestURI": "https://raw.githubusercontent.com/cuteceo/seanime-aniliberty-provider/main/src/AniLiberty/manifest.json",
  "version": "1.0.0",
  "author": "cuteceo",
  "type": "onlinestream-provider",
  "language": "typescript",
  "lang": "ru",
  "payload": "/// <reference path=\"./online-streaming-provider.d.ts\" />\n/// <reference path=\"./doc.d.ts\"/>\n\nclass Provider {\n  api = \"https://aniliberty.top/api/v1\";\n  \n  getSettings(): Settings {\n    return {\n      episodeServers: [\"AniLiberty Server\"],\n      supportsDub: false, // AniLiberty only has Russian dubs\n    };\n  }\n\n  async search(query: SearchOptions): Promise<SearchResult[]> {\n    let normalizedQuery = this.normalizeQuery(query[\"query\"]);\n    console.log(\"Normalized Query: \" + normalizedQuery);\n\n    const url = `${this.api}/app/search/releases?query=${encodeURIComponent(normalizedQuery)}`;\n\n    try {\n      const response = await this._makeRequest(url);\n      const data = JSON.parse(response);\n      \n      if (!data.list || data.list.length === 0) {\n        throw new Error(\"No results found\");\n      }\n\n      const animes: SearchResult[] = [];\n      \n      data.list.forEach((release: any) => {\n        const anime: SearchResult = {\n          id: release.id.toString(),\n          url: `${this.api}/anime/releases/${release.id}`,\n          title: release.names.ru || release.names.en || release.names.original,\n          subOrDub: \"sub\", // AniLiberty is Russian-focused\n        };\n\n        animes.push(anime);\n      });\n\n      return animes;\n    }\n    catch (ex: any) {\n      throw new Error(ex);\n    }\n  }\n\n  async findEpisodes(id: string): Promise<EpisodeDetails[]> {\n    const url = `${this.api}/anime/releases/${id}`;\n\n    try {\n      const response = await this._makeRequest(url);\n      const data = JSON.parse(response);\n      \n      if (!data.episodes || data.episodes.length === 0) {\n        throw new Error(\"No episodes found\");\n      }\n\n      const episodes: EpisodeDetails[] = [];\n      \n      data.episodes.forEach((episode: any) => {\n        const episodeDetails: EpisodeDetails = {\n          id: episode.id,\n          number: episode.ordinal || episode.sort_order,\n          title: episode.name || `Episode ${episode.ordinal || episode.sort_order}`,\n          url: `${this.api}/anime/releases/episodes/${episode.id}`\n        };\n\n        episodes.push(episodeDetails);\n      });\n\n      // Sort episodes by ordinal/sort_order\n      episodes.sort((a, b) => (a.number || 0) - (b.number || 0));\n\n      return episodes;\n    }\n    catch (ex: any) {\n      throw new Error(ex);\n    }\n  }\n\n  async findEpisodeServer(\n    episode: EpisodeDetails,\n    _server: string\n  ): Promise<EpisodeServer> {\n    let server = \"AniLiberty Server\";\n    if (_server !== \"default\") server = _server;\n\n    try {\n      const response = await this._makeRequest(episode.url);\n      const data = JSON.parse(response);\n      \n      const videoSources: VideoSource[] = [];\n      \n      // Add available quality streams\n      if (data.hls_1080) {\n        videoSources.push({\n          quality: \"1080p\",\n          subtitles: [],\n          type: \"m3u8\",\n          url: data.hls_1080\n        });\n      }\n      \n      if (data.hls_720) {\n        videoSources.push({\n          quality: \"720p\",\n          subtitles: [],\n          type: \"m3u8\",\n          url: data.hls_720\n        });\n      }\n      \n      if (data.hls_480) {\n        videoSources.push({\n          quality: \"480p\",\n          subtitles: [],\n          type: \"m3u8\",\n          url: data.hls_480\n        });\n      }\n\n      if (videoSources.length === 0) {\n        throw new Error(\"No video sources found\");\n      }\n\n      const episodeServer: EpisodeServer = {\n        server: server,\n        headers: {\n          \"Access-Control-Allow-Origin\": \"*\",\n          \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36 Edg/134.0.0.0\",\n          \"Referer\": \"https://aniliberty.top/\"\n        },\n        videoSources: videoSources\n      };\n\n      return episodeServer;\n    }\n    catch (e: any) {\n      throw new Error(e);\n    }\n  }\n\n  normalizeQuery(query: string): string {\n    let normalizedQuery = query\n      .replace(/\\b(\\d+)(st|nd|rd|th)\\b/g, \"$1\") // Removes suffixes from numbers\n      .replace(/\\s+/g, \" \") // Replaces multiple whitespaces with single\n      .replace(/(\\d+)\\s*Season/i, \"$1\") // Removes season and keeps number\n      .replace(/Season\\s*(\\d+)/i, \"$1\") // Removes season and keeps number\n      .replace(/~/g, \" \") // Removes ~\n      .trim();\n\n    return normalizedQuery;\n  }\n\n  async _makeRequest(url: string): Promise<string> {\n    const response = await fetch(url, {\n      method: \"GET\",\n      headers: {\n        \"DNT\": \"1\",\n        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36 Edg/134.0.0.0\",\n        \"Accept\": \"application/json\",\n        \"Accept-Language\": \"ru-RU,ru;q=0.9,en;q=0.8\",\n        \"Referer\": \"https://aniliberty.top/\"\n      },\n    });\n    \n    if (!response.ok) {\n      throw new Error(`Failed to fetch: ${response.statusText}`);\n    }\n    \n    const body = await response.text();\n    return body;\n  }\n}\n"
} 